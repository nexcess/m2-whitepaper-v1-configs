## Pretty much have to go with ctl:ruleRemoveTargetByTag/id type whitelisting,
# due to pretty much everything in the backend posting to /administrator/index.php
# TODO:
# Compoents, Extensions, Tools, Help


# New Article free text fields
SecRule REQUEST_METHOD "^POST$" "chain,t:none,pass,nolog,id:'4094000'"
	SecRule REQUEST_URI "/administrator/index.php" " \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:text, \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:text, \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:params[keyref], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:params[keyref], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:params[readmore], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:params[readmore], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:meta[description], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:meta[description], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:meta[keywords], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:meta[keywords]"

# Category Description free text field (ARGS:description)
# Components --> Banners -->  Clients --> Extra Information free text field. (ARGS:extrainfor)
# Components --> Banenrs --> Banners free text fields (ARGS:custombannercode, ARGS:tags)
SecRule REQUEST_METHOD "^POST$" "chain,t:none,pass,nolog,id:'4094001'"
	SecRule REQUEST_URI "/administrator/index.php" " \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:description, \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:description \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:extrainfo \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:extrainfo \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:custombannercode \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:custombannercode \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:tags \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:tags \
	ctl:ruleRemoveTargetById=950911;ARGS:tags"

# Lots of places this could legitimately show up in backend.
<LocationMatch /administrator/index.php>
	SecRuleRemoveById 950120
</LocationMatch>

# Golbal Configuration -- Site Offline Message free text field & Legal/Illegal Mime Types
SecRule REQUEST_METHOD "^POST$" "chain,t:none,pass,nolog,id:'4094002'"
	SecRule REQUEST_URI "/administrator/index.php" " \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:offline_message, \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:offline_message, \
	ctl:ruleRemoveTargetById=973302;ARGS:mediaparams[upload_mime], \
	ctl:ruleRemoveTargetById=973302;ARGS:mediaparams[upload_mime_illegal]"

# Installing Extensions
SecRule REQUEST_METHOD "^POST$" "chain,t:none,pass,nolog,id:'4094003'"
	SecRule REQUEST_URI "/administrator/index.php" " \
	ctl:ruleRemoveTargetById=950109;ARGS:install_url"

# Template HTML/CSS Editor
SecRule REQUEST_METHOD "^POST$" "chain,t:none,pass,nolog,id:'4094004'"
	SecRule REQUEST_URI "/administrator/index.php" " \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/;ARGS:filecontent, \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/PROTOCOL_VIOLATION/;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=981300-981317;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=960024;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=950018;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=950019;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=950910;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=950911;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=981133;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=981134;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=950109;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=973338;ARGS:filecontent, \
	ctl:ruleRemoveTargetById=950103;REQUEST_BODY"

# Message and Mass Mail free text fields
SecRule REQUEST_METHOD "^POST$" "chain,t:none,pass,nolog,id:'4094005'"
	SecRule REQUEST_URI "/administrator/index.php" " \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:message, \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:message, \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:mm_message, \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:mm_message"

###
## Joomla 2.5 Specific Rules
###

# New Article Fields: ARGS:jform[articletext]
# Category Description free text field: ARGS:jform[description]
# User Notes free text field: ARGS:jform[body]
# Offline Message free text field: jform[offline_message]
# Mass Mail free text field: ARGS:jform[message]
# Contact Manager desription free text field: ARGS:jform[misc]
SecRule REQUEST_METHOD "^POST$" "chain,t:none,pass,nolog,id:'4094006'"
	SecRule REQUEST_URI "/administrator/index.php" " \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:jform[articletext], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:jform[articletext], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:jform[description], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:jform[description], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:jform[body], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:jform[body], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:jform[offline_message], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:jform[offline_message], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:jform[message], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:jform[message], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/XSS;ARGS:jform[misc], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK/SQL_INJECTION;ARGS:jform[misc]"


###
## Joomla 3.1 Specific Rules
###

# Global options thingy --> media manager: ARGS:jform[upload_mime]
SecRule REQUEST_METHOD "^POST$" "chain,t:none,pass,nolog,id:'4094007'"
	SecRule REQUEST_URI "/administrator/index.php" " \
	ctl:ruleRemoveTargetById=973302;ARGS:jform[upload_mime]"

# Adding custom banner code
SecRule REQUEST_METHOD "^POST$" "chain,t:none,pass,nolog,id:'4094008'"
	SecRule REQUEST_URI "/administrator/index.php" " \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/WEB_ATTACK;ARGS:jform[custombannercode], \
	ctl:ruleRemoveTargetByTag=OWASP_CRS/PROTOCOL_VIOLATION/;;ARGS:jform[custombannercode]"
